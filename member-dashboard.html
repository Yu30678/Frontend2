<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æœƒå“¡å¾Œå° - ç®¡ç†ç³»çµ±</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Microsoft JhengHei', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      display: flex;
    }

    /* å´é‚Šæ¬„æ¨£å¼ */
    .sidebar {
      width: 260px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .sidebar-header {
      padding: 25px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      text-align: center;
    }

    .user-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 24px;
      color: white;
    }

    .user-name {
      color: white;
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .user-role {
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.9em;
    }

    .sidebar-menu {
      padding: 20px 0;
    }

    .menu-item {
      display: block;
      padding: 15px 25px;
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      cursor: pointer;
    }

    .menu-item:hover,
    .menu-item.active {
      background: rgba(255, 255, 255, 0.1);
      border-left-color: white;
      color: white;
      transform: translateX(5px);
    }

    .menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .logout-btn {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      color: white;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* ä¸»è¦å…§å®¹å€åŸŸ */
    .main-content {
      margin-left: 260px;
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .top-bar {
      background: white;
      padding: 20px 30px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .page-title {
      font-size: 1.8em;
      color: #333;
      font-weight: bold;
    }

    .top-bar-actions {
      display: flex;
      gap: 15px;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .notification-icon:hover {
      background: #667eea;
      color: white;
    }

    .content-area {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    /* å…§å®¹å¡ç‰‡æ¨£å¼ */
    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .card-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 15px;
    }

    .card-title {
      font-size: 0.9em;
      color: #666;
      margin-bottom: 5px;
    }

    .card-value {
      font-size: 1.8em;
      font-weight: bold;
      color: #333;
    }

    /* å•†å“ç€è¦½æ¨£å¼ */
    .product-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .product-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-5px);
    }

    .product-image {
      width: 100%;
      height: 200px;
      background: linear-gradient(45deg, #f0f2f5, #e9ecef);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      color: #adb5bd;
    }

    .product-info {
      padding: 20px;
    }

    .product-name {
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }

    .product-price {
      font-size: 1.4em;
      color: #667eea;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .product-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      flex: 1;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5a6fd8;
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #6c757d;
      border: 1px solid #dee2e6;
    }

    .btn-secondary:hover {
      background: #e9ecef;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #6c757d !important;
    }

    .btn:disabled:hover {
      transform: none;
      box-shadow: none;
    }

    /* è¡¨æ ¼æ¨£å¼ */
    .data-table {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .table-header {
      background: #f8f9fa;
      padding: 20px;
      border-bottom: 1px solid #dee2e6;
    }

    .table-title {
      font-size: 1.3em;
      font-weight: bold;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid #f1f3f4;
    }

    th {
      background: #f8f9fa;
      color: #666;
      font-weight: 600;
      font-size: 0.9em;
      text-transform: uppercase;
    }

    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-cancelled {
      background: #f8d7da;
      color: #721c24;
    }

    /* è¡¨å–®æ¨£å¼ */
    .form-container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #667eea;
    }

  </style>
</head>
<body>
<!-- å´é‚Šæ¬„ -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="user-avatar">ğŸ‘¤</div>
    <div class="user-name" id="userName">æœƒå“¡åç¨±</div>
    <div class="user-role">ä¸€èˆ¬æœƒå“¡</div>
  </div>

  <nav class="sidebar-menu">
    <a href="#" class="menu-item active" onclick="showSection('products')">
      <i>ğŸ›ï¸</i> ç€è¦½å•†å“
    </a>
    <a href="#" class="menu-item" onclick="showSection('cart')">
      <i>ğŸ›’</i> æŸ¥çœ‹è³¼ç‰©è»Š
    </a>
    <a href="#" class="menu-item" onclick="showSection('orders')">
      <i>ğŸ“‹</i> æŸ¥çœ‹è¨‚å–®
    </a>
    <a href="#" class="menu-item" onclick="showSection('profile')">
      <i>ğŸ‘¤</i> ä¿®æ”¹å€‹äººè³‡æ–™
    </a>
  </nav>

  <div class="logout-btn" onclick="logout()">
    <i>ğŸšª</i> ç™»å‡º
  </div>
</div>

<!-- ä¸»è¦å…§å®¹å€åŸŸ -->
<div class="main-content">
  <!-- é ‚éƒ¨æ¬„ -->
  <div class="top-bar">
    <h1 class="page-title" id="pageTitle">ç€è¦½å•†å“</h1>
    <div class="top-bar-actions">
      <div class="notification-icon" onclick="showNotifications()">ğŸ””</div>
      <div class="notification-icon" onclick="showProfile()">âš™ï¸</div>
    </div>
  </div>

  <!-- å…§å®¹å€åŸŸ -->
  <div class="content-area">
    <!-- ç€è¦½å•†å“é é¢ -->
    <div id="products" class="content-section active">
      <div id="productsLoading" style="text-align: center; padding: 50px;">
        <div style="font-size: 48px; margin-bottom: 20px;">â³</div>
        <div>æ­£åœ¨è¼‰å…¥å•†å“è³‡æ–™...</div>
      </div>
      <div id="productsList" class="product-grid" style="display: none;">
        <!-- å•†å“åˆ—è¡¨å°‡ç”± API å‹•æ…‹è¼‰å…¥ -->
      </div>
    </div>

    <!-- è³¼ç‰©è»Šé é¢ -->
    <div id="cart" class="content-section">
      <div id="cartLoading" style="text-align: center; padding: 50px; display: none;">
        <div style="font-size: 48px; margin-bottom: 20px;">â³</div>
        <div>æ­£åœ¨è¼‰å…¥è³¼ç‰©è»Šè³‡æ–™...</div>
      </div>

      <div id="cartContent">
        <div class="data-table">
          <div class="table-header">
            <div class="table-title" id="cartTitle">è³¼ç‰©è»Š (0 ä»¶å•†å“)</div>
            <button class="btn btn-secondary" onclick="refreshCart()" style="margin-left: auto;">ğŸ”„ é‡æ–°æ•´ç†</button>
          </div>
          <div id="cartTableContainer">
            <table id="cartTable">
              <thead>
              <tr>
                <th>å•†å“</th>
                <th>å–®åƒ¹</th>
                <th>æ•¸é‡</th>
                <th>å°è¨ˆ</th>
                <th>æ“ä½œ</th>
              </tr>
              </thead>
              <tbody id="cartTableBody">
                <!-- è³¼ç‰©è»Šå•†å“å°‡å‹•æ…‹è¼‰å…¥ -->
              </tbody>
            </table>
          </div>
        </div>

        <div id="cartSummary" style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);">
          <div>
            <span style="font-size: 1.2em; color: #666;">ç¸½è¨ˆï¼š</span>
            <span style="font-size: 1.8em; font-weight: bold; color: #667eea;" id="cartTotal">$0</span>
          </div>
          <button class="btn btn-primary" style="padding: 15px 30px; font-size: 1.1em;" id="checkoutBtn" disabled onclick="proceedToCheckout()">å‰å¾€çµå¸³</button>
        </div>
      </div>
    </div>

    <!-- è¨‚å–®é é¢ -->
    <div id="orders" class="content-section">
      <div id="ordersLoading" style="text-align: center; padding: 50px; display: none;">
        <div style="font-size: 48px; margin-bottom: 20px;">â³</div>
        <div>æ­£åœ¨è¼‰å…¥è¨‚å–®è³‡æ–™...</div>
      </div>

      <div id="ordersContent">
        <div class="data-table">
          <div class="table-header">
            <div class="table-title" id="ordersTitle">æˆ‘çš„è¨‚å–® (0 ç­†è¨‚å–®)</div>
            <button class="btn btn-secondary" onclick="refreshOrders()" style="margin-left: auto;">ğŸ”„ é‡æ–°æ•´ç†</button>
          </div>
          <div id="ordersTableContainer">
            <table id="ordersTable">
              <thead>
              <tr>
                <th>è¨‚å–®ç·¨è™Ÿ</th>
                <th>è¨‚å–®æ—¥æœŸ</th>
                <th>å•†å“æ•¸é‡</th>
                <th>ç¸½é‡‘é¡</th>
                <th>æ“ä½œ</th>
              </tr>
              </thead>
              <tbody id="ordersTableBody">
                <!-- è¨‚å–®åˆ—è¡¨å°‡å‹•æ…‹è¼‰å…¥ -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- å€‹äººè³‡æ–™é é¢ -->
    <div id="profile" class="content-section">
      <div class="form-container">
        <h2 style="margin-bottom: 30px; color: #333;">ä¿®æ”¹å€‹äººè³‡æ–™</h2>
        <form id="profileForm">
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="form-group">
              <label class="form-label">å§“å</label>
              <input type="text" class="form-input" value="å¼µå°æ˜" id="profileName">
            </div>
            <div class="form-group">
              <label class="form-label">é›»å­éƒµä»¶</label>
              <input type="email" class="form-input" value="user@example.com" id="profileEmail">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">é›»è©±è™Ÿç¢¼</label>
            <input type="tel" class="form-input" value="" id="profilePhone">
          </div>

          <div class="form-group">
            <label class="form-label">åœ°å€</label>
            <input type="text" class="form-input" value="å°åŒ—å¸‚ä¿¡ç¾©å€ä¿¡ç¾©è·¯äº”æ®µ7è™Ÿ" id="profileAddress">
          </div>

          <div class="form-group">
            <label class="form-label">å¯†ç¢¼</label>
            <input type="password" class="form-input" placeholder="è¼¸å…¥å¯†ç¢¼ï¼ˆå¿…å¡«ï¼‰" id="profilePassword" required>
            <small style="color: #666; font-size: 0.9em; margin-top: 5px; display: block;">
              å¦‚æœä¸æƒ³æ›´æ”¹å¯†ç¢¼ï¼Œè«‹è¼¸å…¥ç›®å‰çš„å¯†ç¢¼
            </small>
          </div>

          <div class="form-group">
            <label class="form-label">ç¢ºèªå¯†ç¢¼</label>
            <input type="password" class="form-input" placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼" id="profilePasswordConfirm" required>
          </div>

          <div style="display: flex; gap: 15px; margin-top: 30px;">
            <button type="submit" class="btn btn-primary">å„²å­˜è®Šæ›´</button>
            <button type="button" class="btn btn-secondary" onclick="resetProfile()">é‡ç½®</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>

<script>
  // API è¨­å®š
  const API_CONFIG = {
    productURL: 'http://localhost:8080/product',
    cartURL: 'http://localhost:8080/cart',
    memberURL: 'http://localhost:8080/member',
    orderURL: 'http://localhost:8080/order',
    imageBaseURL: 'http://localhost:8081/images/'  // Dockeråœ–ç‰‡æœå‹™
  };

  // ç²å–ç•¶å‰ç™»å…¥çš„æœƒå“¡ID (å¾ç™»å…¥ç‹€æ…‹æˆ–localStorageå–å¾—)
  function getCurrentMember_id() {
    // æ–¹æ³•1: å¾localStorageå–å¾—
    const member_id = localStorage.getItem('member_id');
    if (member_id && member_id !== 'null' && member_id !== 'undefined') {
      console.log('âœ… å¾localStorageå–å¾—æœƒå“¡ID:', member_id);
      return parseInt(member_id);
    }

    // æ–¹æ³•2: å¾sessionStorageå–å¾—
    const sessionMember_id = sessionStorage.getItem('member_id');
    if (sessionMember_id && sessionMember_id !== 'null' && sessionMember_id !== 'undefined') {
      console.log('âœ… å¾sessionStorageå–å¾—æœƒå“¡ID:', sessionMember_id);
      return parseInt(sessionMember_id);
    }

    // æ–¹æ³•3: å¾URLåƒæ•¸å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const urlMember_id = urlParams.get('member_id');
    if (urlMember_id) {
      console.log('âœ… å¾URLåƒæ•¸å–å¾—æœƒå“¡ID:', urlMember_id);
      return parseInt(urlMember_id);
    }

    // å¦‚æœéƒ½æ²’æœ‰ï¼Œæª¢æŸ¥æ˜¯å¦æœ‰ç™»å…¥token
    const authToken = localStorage.getItem('authToken');
    if (!authToken) {
      console.error('âŒ æœªæ‰¾åˆ°ç™»å…¥tokenï¼Œè«‹é‡æ–°ç™»å…¥');
      alert('è«‹å…ˆç™»å…¥æœƒå“¡');
      window.location.href = 'memberlogin.html';
      return null;
    }

    // å¦‚æœéƒ½æ²’æœ‰ï¼Œé¡¯ç¤ºè­¦å‘Šä¸¦ä½¿ç”¨é è¨­å€¼
    console.warn('âš ï¸ ç„¡æ³•å–å¾—æœƒå“¡IDä½†æœ‰ç™»å…¥tokenï¼Œä½¿ç”¨é è¨­å€¼1');
    showToast('warning', 'æœƒå“¡è³‡è¨Šè¼‰å…¥ç•°å¸¸ï¼Œè«‹ç¨å¾Œé‡æ–°ç™»å…¥');
    return 1; // é è¨­å€¼
  }

  // åˆå§‹åŒ–æœƒå“¡è³‡è¨Šé¡¯ç¤º
  function initMemberInfo() {
    const memberName = localStorage.getItem('memberName');
    const memberEmail = localStorage.getItem('memberEmail');

    if (memberName) {
      const userNameElement = document.getElementById('userName');
      if (userNameElement) {
        userNameElement.textContent = memberName;
        console.log('âœ… æœƒå“¡å§“åå·²é¡¯ç¤º:', memberName);
      }
    }

    console.log('æœƒå“¡è³‡è¨Šåˆå§‹åŒ–å®Œæˆ - å§“å:', memberName, 'Email:', memberEmail);
  }

  // å…¨åŸŸè®Šæ•¸
  let currentSection = 'products';
  let currentProducts = []; // å„²å­˜ç•¶å‰è¼‰å…¥çš„å•†å“è³‡æ–™
  let currentMember_id = getCurrentMember_id(); // ç•¶å‰ç™»å…¥çš„æœƒå“¡ID

  console.log('ğŸ”‘ ç•¶å‰æœƒå“¡ID:', currentMember_id);

  // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
  window.addEventListener('load', function() {
    initMemberInfo(); // åˆå§‹åŒ–æœƒå“¡è³‡è¨Šé¡¯ç¤º
    loadProducts();
  });

  // è¼‰å…¥å•†å“è³‡æ–™
  async function loadProducts() {
    try {
      console.log('æ­£åœ¨è¼‰å…¥å•†å“è³‡æ–™...');

      const response = await fetch(API_CONFIG.productURL, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/json'
        },
        mode: 'cors',
        credentials: 'omit'
      });

      console.log('å•†å“APIå›æ‡‰ç‹€æ…‹:', response.status);

      if (response.ok) {
        const responseData = await response.json();
        console.log('å®Œæ•´APIå›æ‡‰:', responseData);

        // éš±è—è¼‰å…¥ä¸­æç¤º
        document.getElementById('productsLoading').style.display = 'none';

        // é¡¯ç¤ºå•†å“åˆ—è¡¨
        document.getElementById('productsList').style.display = 'grid';

        // å¾APIå›æ‡‰ä¸­æå–å•†å“é™£åˆ—
        let products = [];

        if (responseData.data && Array.isArray(responseData.data)) {
          // æ¨™æº–å›æ‡‰æ ¼å¼ï¼š{status: 200, message: "...", data: [...]}
          products = responseData.data;
          console.log('å¾dataæ¬„ä½æå–å•†å“:', products);
        } else if (Array.isArray(responseData)) {
          // ç›´æ¥é™£åˆ—å›æ‡‰
          products = responseData;
          console.log('ç›´æ¥é™£åˆ—æ ¼å¼:', products);
        } else if (responseData.products && Array.isArray(responseData.products)) {
          // å…¶ä»–å¯èƒ½çš„æ ¼å¼
          products = responseData.products;
          console.log('å¾productsæ¬„ä½æå–:', products);
        } else {
          console.log('ç„¡æ³•è­˜åˆ¥çš„å›æ‡‰æ ¼å¼ï¼Œå˜—è©¦åŒ…è£ç‚ºé™£åˆ—');
          products = [responseData];
        }

        console.log('æœ€çµ‚å•†å“é™£åˆ—:', products);
        console.log('å•†å“æ•¸é‡:', products.length);

        // éæ¿¾æ‰ä¸‹æ¶å•†å“ (is_active = 0)
        const activeProducts = products.filter(product => {
          // æª¢æŸ¥å•†å“æ˜¯å¦ä¸Šæ¶ (is_active = 1)
          const isActive = product.is_active === 1 || product.is_active === true || product.is_active === "1";
          if (!isActive) {
            console.log(`å•†å“ "${product.name}" å·²ä¸‹æ¶ï¼Œä¸é¡¯ç¤º (is_active: ${product.is_active})`);
          }
          return isActive;
        });

        console.log(`å•†å“éæ¿¾çµæœ: ç¸½å•†å“ ${products.length} å€‹ï¼Œä¸Šæ¶å•†å“ ${activeProducts.length} å€‹`);

        // å„²å­˜å•†å“è³‡æ–™ä¾›å…¶ä»–åŠŸèƒ½ä½¿ç”¨ï¼ˆåŒ…å«ä¸‹æ¶å•†å“ï¼‰
        currentProducts = products;

        // æ¸²æŸ“ä¸Šæ¶å•†å“
        renderProducts(activeProducts);
      } else {
        throw new Error(`HTTP ${response.status}: ç„¡æ³•è¼‰å…¥å•†å“è³‡æ–™`);
      }
    } catch (error) {
      console.error('è¼‰å…¥å•†å“å¤±æ•—:', error);

      // æ ¹æ“šéŒ¯èª¤é¡å‹é¡¯ç¤ºä¸åŒè¨Šæ¯
      let errorMessage = error.message;
      if (error.message.includes('CORS') || error.message.includes('Access-Control')) {
        errorMessage = 'CORSè·¨åŸŸéŒ¯èª¤ï¼šè«‹ç¢ºèªå¾Œç«¯CORSè¨­å®š';
      } else if (error.message.includes('Failed to fetch')) {
        errorMessage = 'ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯æœå‹™å™¨ï¼Œè«‹ç¢ºèªæœå‹™å™¨æ˜¯å¦é‹è¡Œ';
      }

      // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å’Œè§£æ±ºå»ºè­°
      document.getElementById('productsLoading').innerHTML = `
                    <div style="text-align: center; padding: 50px; max-width: 600px; margin: 0 auto;">
                        <div style="font-size: 48px; margin-bottom: 20px;">âŒ</div>
                        <div style="color: #e74c3c; font-weight: bold; margin-bottom: 10px;">è¼‰å…¥å•†å“å¤±æ•—</div>
                        <div style="color: #666; margin-bottom: 20px;">${errorMessage}</div>

                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: left;">
                            <div style="font-weight: bold; margin-bottom: 10px;">è§£æ±ºå»ºè­°ï¼š</div>
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                1. ç¢ºèªå¾Œç«¯æœå‹™å™¨é‹è¡Œåœ¨ <code>http://localhost:8080</code><br>
                                2. æª¢æŸ¥å¾Œç«¯CORSè¨­å®šæ˜¯å¦æ­£ç¢º<br>
                                3. ç¢ºèª <code>/product</code> APIç«¯é»æ­£å¸¸é‹ä½œ<br>
                                4. å˜—è©¦ç›´æ¥è¨ªå•ï¼š<a href="${API_CONFIG.productURL}" target="_blank">${API_CONFIG.productURL}</a>
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="btn btn-primary" onclick="loadProducts()">é‡æ–°è¼‰å…¥</button>
                            <button class="btn btn-secondary" onclick="loadTestData()">è¼‰å…¥æ¸¬è©¦è³‡æ–™</button>
                        </div>
                    </div>
                `;
    }
  }

  // è¼‰å…¥æ¸¬è©¦è³‡æ–™ï¼ˆç•¶APIç„¡æ³•ä½¿ç”¨æ™‚ï¼‰
  function loadTestData() {
    console.log('è¼‰å…¥æ¸¬è©¦è³‡æ–™...');

    const testProducts = [
      {
        product_id: 1,
        name: "æ¸¬è©¦å•†å“ - æ™ºèƒ½æ‰‹æ©Ÿ",
        price: 29900,
        soh: 50,
        category_name: "é›»å­ç”¢å“",
        image_url: "http://localhost:8081/images/test.png"
      },
      {
        product_id: 2,
        name: "æ¸¬è©¦å•†å“ - ç­†è¨˜å‹é›»è…¦",
        price: 45500,
        soh: 25,
        category_name: "é›»è…¦",
        image_url: "http://localhost:8081/images/laptop.png"
      },
      {
        product_id: 3,
        name: "æ¸¬è©¦å•†å“ - ç„¡ç·šè€³æ©Ÿ",
        price: 3990,
        soh: 100,
        category_name: "éŸ³éŸ¿",
        image_url: "http://localhost:8081/images/headphone.png"
      }
    ];

    // éš±è—è¼‰å…¥ä¸­æç¤º
    document.getElementById('productsLoading').style.display = 'none';

    // é¡¯ç¤ºå•†å“åˆ—è¡¨
    document.getElementById('productsList').style.display = 'grid';

    // æ¸²æŸ“æ¸¬è©¦å•†å“
    renderProducts(testProducts);

    // é¡¯ç¤ºæ¸¬è©¦è³‡æ–™æç¤º
    alert('å·²è¼‰å…¥æ¸¬è©¦è³‡æ–™ï¼Œè«‹ä¿®å¾©APIé€£æ¥å¾Œé‡æ–°è¼‰å…¥çœŸå¯¦è³‡æ–™');
  }

  // æ¸²æŸ“å•†å“åˆ—è¡¨
  function renderProducts(products) {
    const productsList = document.getElementById('productsList');

    if (!products || products.length === 0) {
      productsList.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 50px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“¦</div>
                        <div style="color: #666;">ç›®å‰æ²’æœ‰å•†å“</div>
                    </div>
                `;
      return;
    }

    productsList.innerHTML = '';

    products.forEach(product => {
      const productCard = document.createElement('div');
      productCard.className = 'product-card';

      // ä½¿ç”¨å•†å“çš„å¯¦éš›åœ–ç‰‡æˆ–é è¨­åœ–ç¤º
      let productImage;
      const imageUrl = getCorrectImageUrl(product.image_url || product.image);

      if (imageUrl) {
        productImage = `<div style="position: relative; width: 100%; height: 200px;">
                        <img src="${imageUrl}" alt="${product.name}" style="width: 100%; height: 200px; object-fit: cover;" onload="console.log('âœ… åœ–ç‰‡è¼‰å…¥æˆåŠŸ: ${product.name}')" onerror="console.log('âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•—: ${product.name}'); this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="product-image" style="display: none;">${getProductIcon(product.category_name || product.category || product.name)}</div>
                        </div>`;
      } else {
        productImage = `<div class="product-image">${getProductIcon(product.category_name || product.category || product.name)}</div>`;
      }

      // æª¢æŸ¥åº«å­˜ç‹€æ…‹
      const soh = product.soh || 0;
      const stockStatus = soh > 0 ? `åº«å­˜: ${soh} ä»¶` : 'ç¼ºè²¨';
      const stockColor = soh > 0 ? '#28a745' : '#dc3545';
      const isOutOfStock = soh <= 0;

      productCard.innerHTML = `
                    ${productImage}
                    <div class="product-info">
                        <div class="product-name">${product.name || 'å•†å“åç¨±'}</div>
                        <div class="product-price">${formatPrice(product.price || 0)}</div>
                        <div style="color: ${stockColor}; font-size: 0.9em; margin-bottom: 15px; font-weight: 500;">
                            ${stockStatus}
                        </div>
                        <div class="product-actions">
                            <button class="btn btn-primary" id="cart-btn-${product.product_id || product.id}" onclick="addToCart('${product.product_id || product.id}')" ${isOutOfStock ? 'disabled' : ''}>
                                ${isOutOfStock ? 'ç¼ºè²¨ä¸­' : 'åŠ å…¥è³¼ç‰©è»Š'}
                            </button>
                            <button class="btn btn-secondary" onclick="viewProductDetails('${product.product_id || product.id}')">æŸ¥çœ‹è©³æƒ…</button>
                        </div>
                    </div>
                `;

      productsList.appendChild(productCard);
    });
  }

  // ä¿®æ­£åœ–ç‰‡URLæ ¼å¼
  function getCorrectImageUrl(imageUrl) {
    if (!imageUrl) return null;

    // å¦‚æœå·²ç¶“æ˜¯å®Œæ•´çš„æ­£ç¢ºæ ¼å¼URLï¼Œç›´æ¥è¿”å›
    if (imageUrl.startsWith('http://localhost:8081/images/')) {
      return imageUrl;
    }

    // å¦‚æœæ˜¯å…¶ä»–å®Œæ•´URLä½†ä¸æ˜¯æˆ‘å€‘çš„åœ–ç‰‡æœå‹™ï¼Œå˜—è©¦æå–æª”å
    if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
      const filename = imageUrl.split('/').pop();
      return API_CONFIG.imageBaseURL + filename;
    }

    // å¦‚æœæ˜¯ç›¸å°è·¯å¾‘ï¼Œæå–æª”å
    if (imageUrl.startsWith('/images/')) {
      const filename = imageUrl.substring(8); // ç§»é™¤å‰é¢çš„ '/images/'
      return API_CONFIG.imageBaseURL + filename;
    }

    // å¦‚æœåªæ˜¯æª”åï¼Œç›´æ¥çµ„åˆ
    return API_CONFIG.imageBaseURL + imageUrl;
  }

  // æ ¹æ“šå•†å“é¡åˆ¥æˆ–åç¨±è¿”å›é©ç•¶çš„åœ–ç¤º
  function getProductIcon(categoryOrName) {
    const name = (categoryOrName || '').toLowerCase();

    if (name.includes('phone') || name.includes('æ‰‹æ©Ÿ')) return 'ğŸ“±';
    if (name.includes('computer') || name.includes('é›»è…¦') || name.includes('ç­†é›»')) return 'ğŸ’»';
    if (name.includes('headphone') || name.includes('è€³æ©Ÿ')) return 'ğŸ§';
    if (name.includes('watch') || name.includes('æ‰‹éŒ¶')) return 'âŒš';
    if (name.includes('tablet') || name.includes('å¹³æ¿')) return 'ğŸ“²';
    if (name.includes('camera') || name.includes('ç›¸æ©Ÿ')) return 'ğŸ“·';
    if (name.includes('speaker') || name.includes('å–‡å­')) return 'ğŸ”Š';
    if (name.includes('keyboard') || name.includes('éµç›¤')) return 'âŒ¨ï¸';
    if (name.includes('mouse') || name.includes('æ»‘é¼ ')) return 'ğŸ–±ï¸';

    return 'ğŸ›ï¸'; // é è¨­åœ–ç¤º
  }

  // æ ¼å¼åŒ–åƒ¹æ ¼
  function formatPrice(price) {
    return new Intl.NumberFormat('zh-TW').format(price);
  }

  // åŠ å…¥è³¼ç‰©è»Š
  async function addToCart(productId) {
    console.log('ğŸ›’ é–‹å§‹åŠ å…¥è³¼ç‰©è»Šæµç¨‹ï¼Œå•†å“ID:', productId);
    console.log('ğŸ” å•†å“IDé¡å‹:', typeof productId);

    // ç¢ºä¿product_idæ˜¯æ•´æ•¸å‹æ…‹
    const numericProductId = parseInt(productId);
    console.log('ğŸ”¢ è½‰æ›å¾Œçš„å•†å“ID:', numericProductId);

    // æª¢æŸ¥å•†å“æ˜¯å¦å­˜åœ¨æ–¼ç•¶å‰è¼‰å…¥çš„å•†å“åˆ—è¡¨ä¸­
    const product = currentProducts.find(p => p.product_id === numericProductId);
    if (!product) {
      console.error('âŒ å•†å“ä¸åœ¨ç•¶å‰åˆ—è¡¨ä¸­:', numericProductId);
      console.log('ğŸ“‹ ç•¶å‰å¯ç”¨çš„å•†å“ID:', currentProducts.map(p => p.product_id));
      showToast('error', `å•†å“ID ${numericProductId} ä¸å­˜åœ¨æ–¼ç•¶å‰å•†å“åˆ—è¡¨ä¸­`);
      return;
    }

    console.log('âœ… æ‰¾åˆ°å•†å“:', product);

    // æª¢æŸ¥åº«å­˜
    if (product.soh <= 0) {
      showToast('error', 'å•†å“å·²ç¼ºè²¨');
      return;
    }

    // æ‰¾åˆ°å°æ‡‰çš„æŒ‰éˆ•
    let button = document.getElementById(`cart-btn-${productId}`);
    if (!button) {
      // å¦‚æœæ‰¾ä¸åˆ°IDï¼Œå˜—è©¦ç”¨onclickå±¬æ€§æ‰¾
      button = document.querySelector(`button[onclick*="addToCart('${productId}')"]`);
    }

    try {
      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      if (button) {
        const originalText = button.innerHTML;
        button.disabled = true;
        button.innerHTML = '<span class="loading-spinner"></span>åŠ å…¥ä¸­...';
        button.setAttribute('data-original-text', originalText);
      }

      // æº–å‚™è³¼ç‰©è»Šè³‡æ–™
      const cartData = {
        member_id: currentMember_id,
        product_id: numericProductId,
        quantity: 1
      };

      console.log('ğŸ“¤ ç™¼é€è³¼ç‰©è»Šè³‡æ–™:', cartData);
      console.log('ğŸ“ APIåœ°å€:', API_CONFIG.cartURL);

      // ç™¼é€POSTè«‹æ±‚åˆ°è³¼ç‰©è»ŠAPI
      const response = await fetch(API_CONFIG.cartURL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(cartData)
      });

      console.log('ğŸ“¨ è³¼ç‰©è»ŠAPIå›æ‡‰ç‹€æ…‹:', response.status);

      // è®€å–å›æ‡‰å…§å®¹
      const responseText = await response.text();
      console.log('ğŸ“¨ åŸå§‹å›æ‡‰å…§å®¹:', responseText);

      if (response.ok) {
        let result;
        try {
          result = JSON.parse(responseText);
          console.log('ğŸ“¨ è§£æå¾Œçš„å›æ‡‰:', result);
        } catch (parseError) {
          console.error('âŒ JSONè§£æå¤±æ•—:', parseError);
          throw new Error('ä¼ºæœå™¨å›æ‡‰æ ¼å¼éŒ¯èª¤');
        }

        if (result.status === 200) {
          // æˆåŠŸåŠ å…¥è³¼ç‰©è»Š
          console.log('âœ… æˆåŠŸåŠ å…¥è³¼ç‰©è»Š:', result.message);
          showToast('success', result.message || 'æˆåŠŸåŠ å…¥è³¼ç‰©è»Šï¼');

          if (button) {
            // æš«æ™‚æ”¹è®ŠæŒ‰éˆ•ç‹€æ…‹
            button.innerHTML = 'âœ… å·²åŠ å…¥';
            button.style.background = '#28a745';

            // 2ç§’å¾Œæ¢å¾©æŒ‰éˆ•
            setTimeout(() => {
              const originalText = button.getAttribute('data-original-text') || 'åŠ å…¥è³¼ç‰©è»Š';
              button.innerHTML = originalText;
              button.style.background = '';
              button.disabled = false;
              button.removeAttribute('data-original-text');
            }, 2000);
          }

        } else {
          // å¾Œç«¯å›å‚³éŒ¯èª¤ï¼Œé¡¯ç¤ºå…·é«”éŒ¯èª¤è¨Šæ¯
          console.log('âŒ å¾Œç«¯å›å‚³éŒ¯èª¤:', result);

          // é‡å°ç‰¹å®šéŒ¯èª¤æä¾›è§£æ±ºå»ºè­°
          let errorMessage = result.message || 'åŠ å…¥è³¼ç‰©è»Šå¤±æ•—';

          throw new Error(errorMessage);
        }
      } else {
        // HTTPéŒ¯èª¤
        console.error('âŒ HTTPéŒ¯èª¤:', response.status, responseText);

        // å˜—è©¦è§£æéŒ¯èª¤å›æ‡‰
        let errorMessage = `HTTP ${response.status}: ä¼ºæœå™¨éŒ¯èª¤`;
        try {
          const errorResult = JSON.parse(responseText);
          if (errorResult.message) {
            errorMessage = errorResult.message;
          }
        } catch (e) {
          // ç„¡æ³•è§£æéŒ¯èª¤å›æ‡‰ï¼Œä½¿ç”¨é è¨­è¨Šæ¯
        }

        throw new Error(errorMessage);
      }

    } catch (error) {
      console.error('âŒ åŠ å…¥è³¼ç‰©è»ŠéŒ¯èª¤:', error);

      // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
      if (button) {
        const originalText = button.getAttribute('data-original-text') || 'åŠ å…¥è³¼ç‰©è»Š';
        button.disabled = false;
        button.innerHTML = originalText;
        button.style.background = '';
        button.removeAttribute('data-original-text');
      }

      // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
      showToast('error', error.message || 'åŠ å…¥è³¼ç‰©è»Šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  }

  // é¡¯ç¤ºæç¤ºè¨Šæ¯
  function showToast(type, message) {
    // ç§»é™¤ç¾æœ‰çš„toast
    const existingToast = document.getElementById('toast');
    if (existingToast) {
      existingToast.remove();
    }

    // å‰µå»ºæ–°çš„toast
    const toast = document.createElement('div');
    toast.id = 'toast';
    toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 10000;
                opacity: 0;
                transition: all 0.3s ease;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            `;

    // æ ¹æ“šé¡å‹è¨­å®šé¡è‰²
    if (type === 'success') {
      toast.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
    } else if (type === 'error') {
      toast.style.background = 'linear-gradient(45deg, #dc3545, #e74c3c)';
    } else if (type === 'warning') {
      toast.style.background = 'linear-gradient(45deg, #ffc107, #fd7e14)';
    } else {
      toast.style.background = 'linear-gradient(45deg, #007bff, #0056b3)';
    }

    toast.textContent = message;
    document.body.appendChild(toast);

    // é¡¯ç¤ºå‹•ç•«
    setTimeout(() => {
      toast.style.opacity = '1';
      toast.style.transform = 'translateY(0)';
    }, 100);

    // è‡ªå‹•éš±è—
    setTimeout(() => {
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-20px)';
      setTimeout(() => {
        if (toast.parentNode) {
          toast.parentNode.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // è¨­å®šæœƒå“¡IDçš„å‡½æ•¸ï¼ˆä¾›ç™»å…¥é é¢èª¿ç”¨ï¼‰
  function setMember_id(member_id) {
    currentMember_id = member_id;
    localStorage.setItem('member_id', member_id.toString());
    console.log('âœ… æœƒå“¡IDå·²è¨­å®š:', currentMember_id);
  }

  // æ¸¬è©¦åœ–ç‰‡è¼‰å…¥åŠŸèƒ½
  function testAllImages() {
    console.log('ğŸ§ª æ¸¬è©¦æ‰€æœ‰å•†å“åœ–ç‰‡...');
    currentProducts.forEach((product, index) => {
      if (product.image_url) {
        const correctedUrl = getCorrectImageUrl(product.image_url);
        console.log(`å•†å“ ${index + 1}:`, {
          name: product.name,
          original: product.image_url,
          corrected: correctedUrl
        });

        // æ¸¬è©¦åœ–ç‰‡æ˜¯å¦å¯è¼‰å…¥
        const img = new Image();
        img.onload = () => console.log(`âœ… åœ–ç‰‡è¼‰å…¥æˆåŠŸ - ${product.name}`);
        img.onerror = () => console.log(`âŒ åœ–ç‰‡è¼‰å…¥å¤±æ•— - ${product.name}: ${correctedUrl}`);
        img.src = correctedUrl;
      }
    });
  }

  // æŸ¥çœ‹å•†å“è©³æƒ…
  function viewProductDetails(productId) {
    console.log('æŸ¥çœ‹å•†å“è©³æƒ…:', productId);
    showToast('info', `æŸ¥çœ‹å•†å“è©³æƒ… - ID: ${productId}`);
    // é€™è£¡å¯ä»¥è·³è½‰åˆ°å•†å“è©³æƒ…é é¢æˆ–é¡¯ç¤ºè©³æƒ…å½ˆçª—
  }

  // è¼‰å…¥è³¼ç‰©è»Šè³‡æ–™ï¼ˆæŸ¥è©¢ç•¶å‰æœƒå“¡çš„è³¼ç‰©è»Šï¼‰
  async function loadCartData() {
    try {
      console.log('ğŸ›’ è¼‰å…¥è³¼ç‰©è»Šè³‡æ–™ï¼Œæœƒå“¡ID:', currentMember_id);

      // ç¢ºä¿æœƒå“¡IDå­˜åœ¨
      if (!currentMember_id) {
        console.error('âŒ æœƒå“¡IDä¸å­˜åœ¨ï¼Œç„¡æ³•è¼‰å…¥è³¼ç‰©è»Š');
        return [];
      }

      console.log('ğŸ“ APIåœ°å€:', API_CONFIG.cartURL);
      console.log('ğŸ“ å˜—è©¦çš„æœƒå“¡IDé¡å‹:', typeof currentMember_id, 'å€¼:', currentMember_id);

      // æ ¹æ“šä½¿ç”¨è€…ç¢ºèªï¼šå¾Œç«¯ä½¿ç”¨GETæ–¹æ³•ï¼Œå¾URLæŸ¥è©¢åƒæ•¸ç²å–member_id
      const member_id = parseInt(currentMember_id);
      console.log('ğŸ” ä½¿ç”¨GETæ–¹æ³•æŸ¥è©¢è³¼ç‰©è»Šï¼Œæœƒå“¡ID:', member_id);

      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸æ–¹å¼ï¼šcart?member_id=111
      const cartUrlWithParams = `${API_CONFIG.cartURL}?member_id=${member_id}`;
      console.log('ğŸ“¤ ç™¼é€GETæŸ¥è©¢è«‹æ±‚åˆ°:', cartUrlWithParams);

      const response = await fetch(cartUrlWithParams, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });

      console.log('ğŸ“¨ è³¼ç‰©è»ŠæŸ¥è©¢å›æ‡‰ç‹€æ…‹:', response.status);
      const responseText = await response.text();
      console.log('ğŸ“¨ è³¼ç‰©è»ŠæŸ¥è©¢åŸå§‹å›æ‡‰:', responseText);

      if (response.ok) {
        try {
          const result = JSON.parse(responseText);
          console.log('ğŸ“¨ è³¼ç‰©è»ŠæŸ¥è©¢è§£æå¾Œå›æ‡‰:', result);

          // è™•ç†å¤šç¨®å¯èƒ½çš„å›æ‡‰æ ¼å¼
          if (result && result.status === 200 && result.data && Array.isArray(result.data)) {
            console.log('âœ… è³¼ç‰©è»ŠæŸ¥è©¢æˆåŠŸ (æ¨™æº–æ ¼å¼)ï¼Œè³¼ç‰©è»Šå•†å“æ•¸é‡:', result.data.length);
            return result.data;
          } else if (Array.isArray(result)) {
            console.log('âœ… è³¼ç‰©è»ŠæŸ¥è©¢æˆåŠŸ (ç›´æ¥é™£åˆ—)ï¼Œè³¼ç‰©è»Šå•†å“æ•¸é‡:', result.length);
            return result;
          } else if (result && result.data) {
            // å˜—è©¦æå–dataæ¬„ä½
            const cartData = Array.isArray(result.data) ? result.data : [result.data];
            console.log('âœ… è³¼ç‰©è»ŠæŸ¥è©¢æˆåŠŸ (dataæ¬„ä½)ï¼Œè³¼ç‰©è»Šå•†å“æ•¸é‡:', cartData.length);
            return cartData;
          } else if (result && typeof result === 'object') {
            // å¦‚æœæ˜¯å–®ä¸€ç‰©ä»¶ï¼ŒåŒ…è£æˆé™£åˆ—
            console.log('âœ… è³¼ç‰©è»ŠæŸ¥è©¢æˆåŠŸ (å–®ä¸€ç‰©ä»¶)ï¼Œè½‰æ›ç‚ºé™£åˆ—');
            return [result];
          } else {
            console.log('âš ï¸ è³¼ç‰©è»ŠæŸ¥è©¢ï¼šè³¼ç‰©è»Šç‚ºç©ºæˆ–ç„¡æ³•è­˜åˆ¥çš„æ ¼å¼');
            return [];
          }
        } catch (parseError) {
          console.log('âš ï¸ è³¼ç‰©è»ŠæŸ¥è©¢ï¼šJSONè§£æå¤±æ•—', parseError.message);
          return [];
        }
      } else {
        console.log('âš ï¸ è³¼ç‰©è»ŠæŸ¥è©¢å¤±æ•—:', response.status, responseText);
        return [];
      }

      // éŒ¯èª¤è™•ç†
      console.log('âŒ è³¼ç‰©è»ŠæŸ¥è©¢å¤±æ•—');
      console.log('ğŸ“‹ è«‹æª¢æŸ¥ä»¥ä¸‹é …ç›®ï¼š');
      console.log('   1. å¾Œç«¯APIè·¯ç”±æ˜¯å¦æ­£ç¢ºè¨­å®šç‚º GET /cart');
      console.log('   2. å¾Œç«¯æ˜¯å¦æ”¯æ´æŸ¥è©¢åƒæ•¸ ?member_id=XXX');
      console.log('   3. APIç«¯é»URLæ˜¯å¦æ­£ç¢º:', API_CONFIG.cartURL);
      console.log('   4. æœƒå“¡IDæ˜¯å¦æ­£ç¢º:', currentMember_id);
      console.log('   5. å¾Œç«¯æœå‹™æ˜¯å¦é‹è¡Œæ­£å¸¸');
      console.log('   6. CORSè¨­å®šæ˜¯å¦æ­£ç¢º');
      console.log('   7. è³¼ç‰©è»Šè³‡æ–™è¡¨ä¸­æ˜¯å¦æœ‰æœƒå“¡', currentMember_id, 'çš„æ¸¬è©¦è³‡æ–™');
      
      return [];

    } catch (error) {
      console.error('âŒ è¼‰å…¥è³¼ç‰©è»Šå¤±æ•—:', error);
      return [];
    }
  }

  // æ¸²æŸ“è³¼ç‰©è»Šå…§å®¹
  function renderCart(cartItems) {
    console.log('ğŸ¨ æ¸²æŸ“è³¼ç‰©è»Šï¼Œå•†å“æ•¸é‡:', cartItems.length);

    const cartTableBody = document.getElementById('cartTableBody');
    const cartTitle = document.getElementById('cartTitle');
    const cartTotal = document.getElementById('cartTotal');
    const checkoutBtn = document.getElementById('checkoutBtn');

    // æ›´æ–°è³¼ç‰©è»Šæ¨™é¡Œ
    cartTitle.textContent = `è³¼ç‰©è»Š (${cartItems.length} ä»¶å•†å“)`;

    if (!cartItems || cartItems.length === 0) {
      // è³¼ç‰©è»Šç‚ºç©º
      cartTableBody.innerHTML = `
        <tr>
          <td colspan="5" style="text-align: center; padding: 50px; color: #666;">
            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ›’</div>
            <div>æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„</div>
            <div style="margin-top: 10px; font-size: 0.9em;">è¶•å¿«å»ç€è¦½å•†å“å§ï¼</div>
          </td>
        </tr>
      `;
      cartTotal.textContent = '$0';
      checkoutBtn.disabled = true;
      return;
    }

    // æ¸…ç©ºè³¼ç‰©è»Šè¡¨æ ¼
    cartTableBody.innerHTML = '';
    let totalAmount = 0;

    cartItems.forEach(item => {
      console.log('ğŸ›ï¸ è™•ç†è³¼ç‰©è»Šå•†å“:', item);

      // å¾ç•¶å‰å•†å“åˆ—è¡¨ä¸­æ‰¾åˆ°å°æ‡‰å•†å“è©³æƒ…
      const product = currentProducts.find(p => p.product_id === item.product_id);
      const productName = product ? product.name : item.product_name || `å•†å“ ID: ${item.product_id}`;
      const productPrice = product ? product.price : item.price || 0;
      const productIcon = product ? getProductIcon(product.category_name || product.name) : 'ğŸ›ï¸';

      const quantity = item.quantity || 1;
      const subtotal = productPrice * quantity;
      totalAmount += subtotal;

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 24px;">${productIcon}</span>
            <span>${productName}</span>
          </div>
        </td>
        <td>$${formatPrice(productPrice)}</td>
        <td>
          <div style="display: flex; align-items: center; gap: 5px;">
            <button class="btn btn-secondary" style="width: 30px; height: 30px; padding: 0;" onclick="updateCartQuantity(${item.product_id}, ${quantity - 1})">-</button>
            <span style="margin: 0 10px; min-width: 20px; text-align: center;">${quantity}</span>
            <button class="btn btn-secondary" style="width: 30px; height: 30px; padding: 0;" onclick="updateCartQuantity(${item.product_id}, ${quantity + 1})">+</button>
          </div>
        </td>
        <td>$${formatPrice(subtotal)}</td>
        <td>
          <button class="btn btn-secondary" onclick="removeFromCart(${item.product_id})" style="background: #dc3545; color: white;">ç§»é™¤</button>
        </td>
      `;

      cartTableBody.appendChild(row);
    });

    // æ›´æ–°ç¸½è¨ˆ
    cartTotal.textContent = `$${formatPrice(totalAmount)}`;
    checkoutBtn.disabled = totalAmount === 0;

    console.log('ğŸ’° è³¼ç‰©è»Šç¸½é‡‘é¡:', totalAmount);
  }

  // é‡æ–°æ•´ç†è³¼ç‰©è»Š
  async function refreshCart() {
    console.log('ğŸ”„ é‡æ–°æ•´ç†è³¼ç‰©è»Š...');

    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    const cartLoading = document.getElementById('cartLoading');
    const cartContent = document.getElementById('cartContent');

    cartLoading.style.display = 'block';
    cartContent.style.display = 'none';

    try {
      const cartItems = await loadCartData();
      renderCart(cartItems);
      showToast('success', 'è³¼ç‰©è»Šå·²æ›´æ–°');
    } catch (error) {
      console.error('âŒ é‡æ–°æ•´ç†è³¼ç‰©è»Šå¤±æ•—:', error);
      showToast('error', 'è¼‰å…¥è³¼ç‰©è»Šå¤±æ•—');
      renderCart([]); // é¡¯ç¤ºç©ºè³¼ç‰©è»Š
    } finally {
      // éš±è—è¼‰å…¥ç‹€æ…‹
      cartLoading.style.display = 'none';
      cartContent.style.display = 'block';
    }
  }

  // æ›´æ–°è³¼ç‰©è»Šå•†å“æ•¸é‡
  async function updateCartQuantity(productId, newQuantity) {
    console.log('ğŸ“ æ›´æ–°è³¼ç‰©è»Šæ•¸é‡ï¼Œå•†å“ID:', productId, 'æ–°æ•¸é‡:', newQuantity);

    if (newQuantity <= 0) {
      // å¦‚æœæ•¸é‡ç‚º0æˆ–è² æ•¸ï¼Œç§»é™¤å•†å“
      removeFromCart(productId);
      return;
    }

    try {
      const updateData = {
        member_id: currentMember_id,
        product_id: productId,
        quantity: newQuantity
      };

      console.log('ğŸ“¤ ç™¼é€æ›´æ–°è«‹æ±‚:', updateData);

      const response = await fetch(API_CONFIG.cartURL, {
        method: 'PUT', // å‡è¨­æ›´æ–°ç”¨PUTæ–¹æ³•
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(updateData)
      });

      if (response.ok) {
        const result = await response.json();
        if (result.status === 200) {
          console.log('âœ… æ›´æ–°æ•¸é‡æˆåŠŸ');
          refreshCart(); // é‡æ–°è¼‰å…¥è³¼ç‰©è»Š
        } else {
          throw new Error(result.message || 'æ›´æ–°å¤±æ•—');
        }
      } else {
        throw new Error(`HTTP ${response.status}: æ›´æ–°å¤±æ•—`);
      }
    } catch (error) {
      console.error('âŒ æ›´æ–°è³¼ç‰©è»Šæ•¸é‡å¤±æ•—:', error);
      showToast('error', 'æ›´æ–°æ•¸é‡å¤±æ•—');
      refreshCart(); // å³ä½¿å¤±æ•—ä¹Ÿé‡æ–°è¼‰å…¥ä»¥ç¢ºä¿ä¸€è‡´æ€§
    }
  }

  // å¾è³¼ç‰©è»Šç§»é™¤å•†å“
  async function removeFromCart(productId) {
    console.log('ğŸ—‘ï¸ å¾è³¼ç‰©è»Šç§»é™¤å•†å“ï¼ŒID:', productId);

    if (!confirm('ç¢ºå®šè¦ç§»é™¤æ­¤å•†å“å—ï¼Ÿ')) {
      return;
    }

    try {
      const removeData = {
        member_id: currentMember_id,
        product_id: productId
      };

      console.log('ğŸ“¤ ç™¼é€ç§»é™¤è«‹æ±‚:', removeData);

      const response = await fetch(API_CONFIG.cartURL, {
        method: 'DELETE', // å‡è¨­åˆªé™¤ç”¨DELETEæ–¹æ³•
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(removeData)
      });

      if (response.ok) {
        const result = await response.json();
        if (result.status === 200) {
          console.log('âœ… ç§»é™¤å•†å“æˆåŠŸ');
          showToast('success', 'å•†å“å·²å¾è³¼ç‰©è»Šç§»é™¤');
          refreshCart(); // é‡æ–°è¼‰å…¥è³¼ç‰©è»Š
        } else {
          throw new Error(result.message || 'ç§»é™¤å¤±æ•—');
        }
      } else {
        throw new Error(`HTTP ${response.status}: ç§»é™¤å¤±æ•—`);
      }
    } catch (error) {
      console.error('âŒ ç§»é™¤å•†å“å¤±æ•—:', error);
      showToast('error', 'ç§»é™¤å•†å“å¤±æ•—');
    }
  }

  // é¡¯ç¤ºæŒ‡å®šå€å¡Š
  function showSection(sectionName) {
    // éš±è—æ‰€æœ‰å€å¡Š
    document.querySelectorAll('.content-section').forEach(section => {
      section.classList.remove('active');
    });

    // ç§»é™¤æ‰€æœ‰é¸å–®é …ç›®çš„activeç‹€æ…‹
    document.querySelectorAll('.menu-item').forEach(item => {
      item.classList.remove('active');
    });

    // é¡¯ç¤ºæŒ‡å®šå€å¡Š
    document.getElementById(sectionName).classList.add('active');

    // è¨­å®šå°æ‡‰é¸å–®é …ç›®ç‚ºactive
    event.target.classList.add('active');

    // æ›´æ–°é é¢æ¨™é¡Œ
    const titles = {
      'products': 'ç€è¦½å•†å“',
      'cart': 'è³¼ç‰©è»Š',
      'orders': 'æŸ¥çœ‹è¨‚å–®',
      'profile': 'å€‹äººè³‡æ–™'
    };

    document.getElementById('pageTitle').textContent = titles[sectionName];
    currentSection = sectionName;

    // å¦‚æœåˆ‡æ›åˆ°å•†å“é é¢ä¸”å°šæœªè¼‰å…¥ï¼Œå‰‡é‡æ–°è¼‰å…¥
    if (sectionName === 'products') {
      const productsList = document.getElementById('productsList');
      if (productsList.children.length === 0 && document.getElementById('productsLoading').style.display === 'none') {
        loadProducts();
      }
    }

    // å¦‚æœåˆ‡æ›åˆ°è³¼ç‰©è»Šé é¢ï¼Œè¼‰å…¥è³¼ç‰©è»Šè³‡æ–™
    if (sectionName === 'cart') {
      console.log('ğŸ›’ åˆ‡æ›åˆ°è³¼ç‰©è»Šé é¢ï¼Œè¼‰å…¥è³¼ç‰©è»Šè³‡æ–™...');
      refreshCart();
    }

    // å¦‚æœåˆ‡æ›åˆ°è¨‚å–®é é¢ï¼Œè¼‰å…¥è¨‚å–®è³‡æ–™
    if (sectionName === 'orders') {
      console.log('ğŸ“‹ åˆ‡æ›åˆ°è¨‚å–®é é¢ï¼Œè¼‰å…¥è¨‚å–®è³‡æ–™...');
      refreshOrders();
    }

    // å¦‚æœåˆ‡æ›åˆ°å€‹äººè³‡æ–™é é¢ï¼Œè¼‰å…¥å€‹äººè³‡æ–™
    if (sectionName === 'profile') {
      console.log('ğŸ‘¤ åˆ‡æ›åˆ°å€‹äººè³‡æ–™é é¢ï¼Œè¼‰å…¥å€‹äººè³‡æ–™...');
      loadMemberProfile();
    }

  }


  // å‰å¾€çµå¸³åŠŸèƒ½
  async function proceedToCheckout() {
    console.log('ğŸ›ï¸ é–‹å§‹çµå¸³æµç¨‹ï¼Œæœƒå“¡ID:', currentMember_id);

    // ç¢ºä¿æœƒå“¡IDå­˜åœ¨
    if (!currentMember_id) {
      console.error('âŒ æœƒå“¡IDä¸å­˜åœ¨ï¼Œç„¡æ³•é€²è¡Œçµå¸³');
      showToast('error', 'æœƒå“¡IDä¸å­˜åœ¨ï¼Œè«‹é‡æ–°ç™»å…¥');
      return;
    }

    const checkoutBtn = document.getElementById('checkoutBtn');
    const originalText = checkoutBtn.innerHTML;

    try {
      // ç¦ç”¨çµå¸³æŒ‰éˆ•ï¼Œé¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      checkoutBtn.disabled = true;
      checkoutBtn.innerHTML = 'è™•ç†ä¸­...';

      // æº–å‚™è¨‚å–®è³‡æ–™
      const orderData = {
        member_id: currentMember_id
      };

      console.log('ğŸ“¤ ç™¼é€çµå¸³è«‹æ±‚åˆ°:', API_CONFIG.orderURL);
      console.log('ğŸ“¤ çµå¸³è³‡æ–™:', orderData);

      // ç™¼é€POSTè«‹æ±‚åˆ°è¨‚å–®API
      const response = await fetch(API_CONFIG.orderURL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(orderData)
      });

      console.log('ğŸ“¨ çµå¸³APIå›æ‡‰ç‹€æ…‹:', response.status);

      // è®€å–å›æ‡‰å…§å®¹
      const responseText = await response.text();
      console.log('ğŸ“¨ çµå¸³åŸå§‹å›æ‡‰å…§å®¹:', responseText);

      if (response.ok) {
        let result;
        try {
          result = JSON.parse(responseText);
          console.log('ğŸ“¨ çµå¸³è§£æå¾Œçš„å›æ‡‰:', result);
        } catch (parseError) {
          console.error('âŒ çµå¸³JSONè§£æå¤±æ•—:', parseError);
          throw new Error('ä¼ºæœå™¨å›æ‡‰æ ¼å¼éŒ¯èª¤');
        }

        if (result.status === 201 || result.status === 200) {
          // çµå¸³æˆåŠŸ
          console.log('âœ… çµå¸³æˆåŠŸ:', result.message);
          const orderId = result.data ? result.data.order_id : null;
          
          showToast('success', result.message || `è¨‚å–®å»ºç«‹æˆåŠŸï¼${orderId ? `è¨‚å–®ç·¨è™Ÿï¼š${orderId}` : ''}`);

          // çµå¸³æˆåŠŸå¾Œæ¸…ç©ºè³¼ç‰©è»Šé¡¯ç¤º
          setTimeout(() => {
            refreshCart(); // é‡æ–°è¼‰å…¥è³¼ç‰©è»Šï¼ˆæ‡‰è©²æœƒæ˜¯ç©ºçš„ï¼‰
            showToast('info', 'æ‚¨çš„è¨‚å–®å·²æˆåŠŸå»ºç«‹ï¼Œè³¼ç‰©è»Šå·²æ¸…ç©º');
          }, 2000);

        } else {
          // å¾Œç«¯å›å‚³éŒ¯èª¤
          console.log('âŒ çµå¸³å¤±æ•—:', result);
          let errorMessage = result.message || 'çµå¸³å¤±æ•—';
          
          // é‡å°ç‰¹å®šéŒ¯èª¤æä¾›æ›´å‹å¥½çš„è¨Šæ¯
          if (errorMessage.includes('è³¼ç‰©è»Šç‚ºç©º')) {
            errorMessage = 'è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼Œè«‹å…ˆåŠ å…¥å•†å“';
          } else if (errorMessage.includes('åº«å­˜ä¸è¶³')) {
            errorMessage = 'éƒ¨åˆ†å•†å“åº«å­˜ä¸è¶³ï¼Œè«‹èª¿æ•´æ•¸é‡å¾Œé‡è©¦';
          } else if (errorMessage.includes('å·²ä¸‹æ¶')) {
            errorMessage = 'è³¼ç‰©è»Šä¸­æœ‰å•†å“å·²ä¸‹æ¶ï¼Œè«‹é‡æ–°é¸è³¼';
          }

          throw new Error(errorMessage);
        }
      } else {
        // HTTPéŒ¯èª¤
        console.error('âŒ çµå¸³HTTPéŒ¯èª¤:', response.status, responseText);

        // å˜—è©¦è§£æéŒ¯èª¤å›æ‡‰
        let errorMessage = `HTTP ${response.status}: çµå¸³å¤±æ•—`;
        try {
          const errorResult = JSON.parse(responseText);
          if (errorResult.message) {
            errorMessage = errorResult.message;
          }
        } catch (e) {
          // ç„¡æ³•è§£æéŒ¯èª¤å›æ‡‰ï¼Œä½¿ç”¨é è¨­è¨Šæ¯
        }

        throw new Error(errorMessage);
      }

    } catch (error) {
      console.error('âŒ çµå¸³éŒ¯èª¤:', error);
      
      // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
      showToast('error', error.message || 'çµå¸³å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
      
      // åˆ·æ–°è³¼ç‰©è»Šä»¥ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
      setTimeout(() => {
        refreshCart();
      }, 1000);
      
    } finally {
      // æ¢å¾©çµå¸³æŒ‰éˆ•ç‹€æ…‹
      checkoutBtn.disabled = false;
      checkoutBtn.innerHTML = originalText;
    }
  }

  // ç™»å‡ºåŠŸèƒ½
  function logout() {
    if (confirm('ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ')) {
      // æ¸…é™¤ç™»å…¥è³‡è¨Š
      console.log('åŸ·è¡Œç™»å‡º...');

      // æ¸…é™¤localStorageå’ŒsessionStorageä¸­çš„æœƒå“¡è³‡è¨Š
      localStorage.removeItem('member_id');
      sessionStorage.removeItem('member_id');

      // è·³è½‰åˆ°ç™»å…¥é é¢
      window.location.href = 'memberlogin.html';
    }
  }

  // é¡¯ç¤ºé€šçŸ¥
  function showNotifications() {
    alert('æ‚¨æœ‰ 3 å‰‡æ–°é€šçŸ¥ï¼\nâ€¢ æ‚¨çš„è¨‚å–®å·²å‡ºè²¨\nâ€¢ æ–°å•†å“ä¸Šæ¶é€šçŸ¥\nâ€¢ æœƒå“¡ç©åˆ†å³å°‡åˆ°æœŸ');
  }

  // é¡¯ç¤ºå€‹äººè¨­å®š
  function showProfile() {
    showSection('profile');
  }

  // è¼‰å…¥æœƒå“¡å€‹äººè³‡æ–™
  async function loadMemberProfile() {
    try {
      // é‡æ–°ç²å–ç•¶å‰æœƒå“¡IDï¼Œç¢ºä¿æ˜¯æœ€æ–°çš„
      currentMember_id = getCurrentMember_id();
      console.log('ğŸ‘¤ è¼‰å…¥æœƒå“¡å€‹äººè³‡æ–™ï¼Œæœƒå“¡ID:', currentMember_id);

      // ç¢ºä¿æœƒå“¡IDå­˜åœ¨
      if (!currentMember_id) {
        console.error('âŒ æœƒå“¡IDä¸å­˜åœ¨ï¼Œç„¡æ³•è¼‰å…¥å€‹äººè³‡æ–™');
        showToast('error', 'æœƒå“¡IDä¸å­˜åœ¨ï¼Œè«‹é‡æ–°ç™»å…¥');
        return;
      }

      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸æ–¹å¼ï¼šmember?member_id=111
      const memberUrlWithParams = `${API_CONFIG.memberURL}?member_id=${currentMember_id}`;
      console.log('ğŸ“¤ ç™¼é€æœƒå“¡è³‡æ–™æŸ¥è©¢è«‹æ±‚åˆ°:', memberUrlWithParams);

      const response = await fetch(memberUrlWithParams, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });

      console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æŸ¥è©¢å›æ‡‰ç‹€æ…‹:', response.status);
      const responseText = await response.text();
      console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æŸ¥è©¢åŸå§‹å›æ‡‰:', responseText);

      if (response.ok) {
        try {
          const result = JSON.parse(responseText);
          console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æŸ¥è©¢è§£æå¾Œå›æ‡‰:', result);

          let memberData = null;

          // è™•ç†å¤šç¨®å¯èƒ½çš„å›æ‡‰æ ¼å¼
          if (result && result.status === 200 && result.data) {
            memberData = result.data;
            console.log('âœ… æœƒå“¡è³‡æ–™æŸ¥è©¢æˆåŠŸ (æ¨™æº–æ ¼å¼)');
          } else if (result && result.member_id) {
            memberData = result;
            console.log('âœ… æœƒå“¡è³‡æ–™æŸ¥è©¢æˆåŠŸ (ç›´æ¥ç‰©ä»¶)');
          } else {
            console.log('âš ï¸ æœƒå“¡è³‡æ–™æŸ¥è©¢ï¼šç„¡æ³•è­˜åˆ¥çš„æ ¼å¼æˆ–ç„¡è³‡æ–™');
            showToast('warning', 'ç„¡æ³•è¼‰å…¥æœƒå“¡è³‡æ–™');
            return;
          }

          // å¡«å……è¡¨å–®è³‡æ–™
          if (memberData) {
            fillProfileForm(memberData);
            showToast('success', 'å€‹äººè³‡æ–™è¼‰å…¥æˆåŠŸ');
          }

        } catch (parseError) {
          console.log('âš ï¸ æœƒå“¡è³‡æ–™æŸ¥è©¢ï¼šJSONè§£æå¤±æ•—', parseError.message);
          showToast('error', 'æœƒå“¡è³‡æ–™æ ¼å¼éŒ¯èª¤');
        }
      } else {
        console.log('âš ï¸ æœƒå“¡è³‡æ–™æŸ¥è©¢å¤±æ•—:', response.status, responseText);
        showToast('error', 'è¼‰å…¥æœƒå“¡è³‡æ–™å¤±æ•—');
      }

    } catch (error) {
      console.error('âŒ è¼‰å…¥æœƒå“¡è³‡æ–™å¤±æ•—:', error);
      showToast('error', 'è¼‰å…¥æœƒå“¡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤');
    }
  }

  // å¡«å……å€‹äººè³‡æ–™è¡¨å–®
  function fillProfileForm(memberData) {
    console.log('ğŸ“ å¡«å……å€‹äººè³‡æ–™è¡¨å–®:', memberData);

    // å¡«å……å„å€‹æ¬„ä½
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    const profilePhone = document.getElementById('profilePhone');
    const profileAddress = document.getElementById('profileAddress');

    if (profileName && memberData.name) {
      profileName.value = memberData.name;
    }

    if (profileEmail && memberData.email) {
      profileEmail.value = memberData.email;
    }

    if (profilePhone && memberData.phone) {
      profilePhone.value = memberData.phone;
    }

    if (profileAddress && memberData.address) {
      profileAddress.value = memberData.address;
    }

    console.log('âœ… å€‹äººè³‡æ–™è¡¨å–®å¡«å……å®Œæˆ');
  }

  // æ›´æ–°æœƒå“¡å€‹äººè³‡æ–™
  async function updateMemberProfile(formData) {
    try {
      console.log('ğŸ“¤ æ›´æ–°æœƒå“¡å€‹äººè³‡æ–™ï¼Œæœƒå“¡ID:', currentMember_id);
      console.log('ğŸ“¤ æ›´æ–°è³‡æ–™:', formData);

      // å»ºç«‹æ›´æ–°è³‡æ–™
      const updateData = {
        member_id: currentMember_id,
        name: formData.name,
        email: formData.email,
        phone: formData.phone,
        address: formData.address
      };

      // ç›´æ¥ä½¿ç”¨ä½¿ç”¨è€…è¼¸å…¥çš„å¯†ç¢¼
      updateData.password = formData.password;
      console.log('âœ… ä½¿ç”¨è¼¸å…¥çš„å¯†ç¢¼æ›´æ–°ï¼ˆå¯èƒ½æ˜¯åŸå¯†ç¢¼æˆ–æ–°å¯†ç¢¼ï¼‰');

      const response = await fetch(API_CONFIG.memberURL, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify(updateData)
      });

      console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æ›´æ–°å›æ‡‰ç‹€æ…‹:', response.status);
      const responseText = await response.text();
      console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æ›´æ–°åŸå§‹å›æ‡‰:', responseText);

      if (response.ok) {
        try {
          const result = JSON.parse(responseText);
          console.log('ğŸ“¨ æœƒå“¡è³‡æ–™æ›´æ–°è§£æå¾Œå›æ‡‰:', result);

          if (result && result.status === 200) {
            console.log('âœ… æœƒå“¡è³‡æ–™æ›´æ–°æˆåŠŸ');
            showToast('success', result.message || 'å€‹äººè³‡æ–™æ›´æ–°æˆåŠŸï¼');
            
            // æ›´æ–°localStorageä¸­çš„æœƒå“¡è³‡è¨Š
            localStorage.setItem('memberName', formData.name);
            localStorage.setItem('memberEmail', formData.email);
            
            // æ›´æ–°å´é‚Šæ¬„é¡¯ç¤ºçš„å§“å
            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
              userNameElement.textContent = formData.name;
            }
            
            return true;
          } else {
            throw new Error(result.message || 'æ›´æ–°å¤±æ•—');
          }

        } catch (parseError) {
          console.log('âš ï¸ æœƒå“¡è³‡æ–™æ›´æ–°ï¼šJSONè§£æå¤±æ•—', parseError.message);
          throw new Error('ä¼ºæœå™¨å›æ‡‰æ ¼å¼éŒ¯èª¤');
        }
      } else {
        const errorMessage = `HTTP ${response.status}: æ›´æ–°å¤±æ•—`;
        console.log('âš ï¸ æœƒå“¡è³‡æ–™æ›´æ–°å¤±æ•—:', errorMessage);
        throw new Error(errorMessage);
      }

    } catch (error) {
      console.error('âŒ æ›´æ–°æœƒå“¡è³‡æ–™å¤±æ•—:', error);
      showToast('error', error.message || 'æ›´æ–°å€‹äººè³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤');
      return false;
    }
  }

  // é‡ç½®å€‹äººè³‡æ–™è¡¨å–®
  function resetProfile() {
    if (confirm('ç¢ºå®šè¦é‡ç½®è¡¨å–®å—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰ä¿®æ”¹çš„å…§å®¹ã€‚')) {
      loadMemberProfile(); // é‡æ–°è¼‰å…¥åŸå§‹è³‡æ–™
    }
  }

  // è¼‰å…¥è¨‚å–®è³‡æ–™ï¼ˆæŸ¥è©¢ç•¶å‰æœƒå“¡çš„è¨‚å–®ï¼‰
  async function loadOrdersData() {
    try {
      console.log('ğŸ“‹ è¼‰å…¥è¨‚å–®è³‡æ–™ï¼Œæœƒå“¡ID:', currentMember_id);

      // ç¢ºä¿æœƒå“¡IDå­˜åœ¨
      if (!currentMember_id) {
        console.error('âŒ æœƒå“¡IDä¸å­˜åœ¨ï¼Œç„¡æ³•è¼‰å…¥è¨‚å–®');
        return [];
      }

      console.log('ğŸ“ APIåœ°å€:', API_CONFIG.orderURL);
      console.log('ğŸ“ ä½¿ç”¨æœƒå“¡ID:', currentMember_id);

      // ä½¿ç”¨æŸ¥è©¢åƒæ•¸æ–¹å¼ï¼šorder?member_id=111
      const orderUrlWithParams = `${API_CONFIG.orderURL}?member_id=${currentMember_id}`;
      console.log('ğŸ“¤ ç™¼é€GETæŸ¥è©¢è«‹æ±‚åˆ°:', orderUrlWithParams);

      const response = await fetch(orderUrlWithParams, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });

      console.log('ğŸ“¨ è¨‚å–®æŸ¥è©¢å›æ‡‰ç‹€æ…‹:', response.status);
      const responseText = await response.text();
      console.log('ğŸ“¨ è¨‚å–®æŸ¥è©¢åŸå§‹å›æ‡‰:', responseText);

      if (response.ok) {
        try {
          const result = JSON.parse(responseText);
          console.log('ğŸ“¨ è¨‚å–®æŸ¥è©¢è§£æå¾Œå›æ‡‰:', result);

          // æ ¹æ“šå¾Œç«¯APIçµæ§‹è™•ç†å›æ‡‰
          if (result && result.status === 200 && result.data) {
            const ordersData = result.data.orders || [];
            const orderDetailsData = result.data.order_details || {};
            
            console.log('âœ… è¨‚å–®æŸ¥è©¢æˆåŠŸï¼Œè¨‚å–®æ•¸é‡:', ordersData.length);
            console.log('âœ… è¨‚å–®è©³æƒ…è³‡æ–™:', orderDetailsData);
            
            // å°‡è¨‚å–®è©³æƒ…åˆä½µåˆ°è¨‚å–®è³‡æ–™ä¸­
            const ordersWithDetails = ordersData.map(order => {
              const orderDetailsKey = `order_${order.order_id}`;
              const details = orderDetailsData[orderDetailsKey] || [];
              
              // è¨ˆç®—ç¸½é‡‘é¡å’Œå•†å“æ•¸é‡
              let totalAmount = 0;
              let totalItems = 0;
              
              details.forEach(detail => {
                totalAmount += (detail.price || 0) * (detail.quantity || 0);
                totalItems += detail.quantity || 0;
              });
              
              return {
                ...order,
                details: details,
                totalAmount: totalAmount,
                totalItems: totalItems
              };
            });
            
            return ordersWithDetails;
          } else if (Array.isArray(result)) {
            console.log('âœ… è¨‚å–®æŸ¥è©¢æˆåŠŸ (ç›´æ¥é™£åˆ—)ï¼Œè¨‚å–®æ•¸é‡:', result.length);
            return result;
          } else {
            console.log('âš ï¸ è¨‚å–®æŸ¥è©¢ï¼šè¨‚å–®ç‚ºç©ºæˆ–ç„¡æ³•è­˜åˆ¥çš„æ ¼å¼');
            return [];
          }
        } catch (parseError) {
          console.log('âš ï¸ è¨‚å–®æŸ¥è©¢ï¼šJSONè§£æå¤±æ•—', parseError.message);
          return [];
        }
      } else {
        console.log('âš ï¸ è¨‚å–®æŸ¥è©¢å¤±æ•—:', response.status, responseText);
        return [];
      }

    } catch (error) {
      console.error('âŒ è¼‰å…¥è¨‚å–®å¤±æ•—:', error);
      return [];
    }
  }

  // æ¸²æŸ“è¨‚å–®åˆ—è¡¨
  function renderOrders(orders) {
    console.log('ğŸ¨ æ¸²æŸ“è¨‚å–®åˆ—è¡¨ï¼Œè¨‚å–®æ•¸é‡:', orders.length);

    const ordersTableBody = document.getElementById('ordersTableBody');
    const ordersTitle = document.getElementById('ordersTitle');

    // æ›´æ–°è¨‚å–®æ¨™é¡Œ
    ordersTitle.textContent = `æˆ‘çš„è¨‚å–® (${orders.length} ç­†è¨‚å–®)`;

    if (!orders || orders.length === 0) {
      // è¨‚å–®ç‚ºç©º
      ordersTableBody.innerHTML = `
        <tr>
          <td colspan="5" style="text-align: center; padding: 50px; color: #666;">
            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“‹</div>
            <div>æ‚¨é‚„æ²’æœ‰ä»»ä½•è¨‚å–®</div>
            <div style="margin-top: 10px; font-size: 0.9em;">å»ç€è¦½å•†å“ä¸‹è¨‚å–®å§ï¼</div>
          </td>
        </tr>
      `;
      return;
    }

    // æ¸…ç©ºè¨‚å–®è¡¨æ ¼
    ordersTableBody.innerHTML = '';

    orders.forEach(order => {
      console.log('ğŸ“¦ è™•ç†è¨‚å–®:', order);

      // æ ¼å¼åŒ–è¨‚å–®æ—¥æœŸ - æ ¹æ“šå¾Œç«¯ order ç‰©ä»¶çš„æ¬„ä½åç¨±
      const orderDate = order.create_at || order.created_at || order.order_date || order.date || 'æœªçŸ¥æ—¥æœŸ';
      const formattedDate = formatOrderDate(orderDate);

      // é¡¯ç¤ºå¯¦éš›çš„å•†å“æ•¸é‡å’Œç¸½é‡‘é¡ï¼ˆå¾å·²ç¶“åˆä½µçš„è©³æƒ…ä¸­å–å¾—ï¼‰
      const itemCount = order.totalItems ? `${order.totalItems} ä»¶` : 'æŸ¥çœ‹è©³æƒ…';
      const totalAmount = order.totalAmount ? `$${formatPrice(order.totalAmount)}` : 'æŸ¥çœ‹è©³æƒ…';

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>
          <div style="display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 18px;">ğŸ“¦</span>
            <span>#${order.order_id || order.id || 'N/A'}</span>
          </div>
        </td>
        <td>${formattedDate}</td>
        <td>${itemCount}</td>
        <td>${totalAmount}</td>
        <td>
          <button class="btn btn-secondary" onclick="viewOrderDetails(${order.order_id || order.id})" style="margin-right: 5px;">æŸ¥çœ‹è©³æƒ…</button>
        </td>
      `;

      ordersTableBody.appendChild(row);
    });

    console.log('âœ… è¨‚å–®åˆ—è¡¨æ¸²æŸ“å®Œæˆ');
  }

  // æ ¼å¼åŒ–è¨‚å–®æ—¥æœŸ
  function formatOrderDate(dateString) {
    try {
      const date = new Date(dateString);
      if (isNaN(date.getTime())) {
        return dateString; // å¦‚æœç„¡æ³•è§£æï¼Œè¿”å›åŸå­—ä¸²
      }
      return date.toLocaleDateString('zh-TW', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
      });
    } catch (error) {
      console.log('âš ï¸ æ—¥æœŸæ ¼å¼åŒ–å¤±æ•—:', error);
      return dateString;
    }
  }

  // é‡æ–°æ•´ç†è¨‚å–®
  async function refreshOrders() {
    console.log('ğŸ”„ é‡æ–°æ•´ç†è¨‚å–®...');

    // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    const ordersLoading = document.getElementById('ordersLoading');
    const ordersContent = document.getElementById('ordersContent');

    ordersLoading.style.display = 'block';
    ordersContent.style.display = 'none';

    try {
      const orders = await loadOrdersData();
      window.currentOrdersData = orders; // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸ä¾›è©³æƒ…æŸ¥çœ‹ä½¿ç”¨
      renderOrders(orders);
      showToast('success', 'è¨‚å–®åˆ—è¡¨å·²æ›´æ–°');
    } catch (error) {
      console.error('âŒ é‡æ–°æ•´ç†è¨‚å–®å¤±æ•—:', error);
      showToast('error', 'è¼‰å…¥è¨‚å–®å¤±æ•—');
      renderOrders([]); // é¡¯ç¤ºç©ºè¨‚å–®åˆ—è¡¨
    } finally {
      // éš±è—è¼‰å…¥ç‹€æ…‹
      ordersLoading.style.display = 'none';
      ordersContent.style.display = 'block';
    }
  }

  // æŸ¥çœ‹è¨‚å–®è©³æƒ…
  async function viewOrderDetails(orderId) {
    console.log('ğŸ” æŸ¥çœ‹è¨‚å–®è©³æƒ…ï¼Œè¨‚å–®ID:', orderId);

    if (!orderId) {
      showToast('error', 'è¨‚å–®IDç„¡æ•ˆ');
      return;
    }

    // é¦–å…ˆå˜—è©¦å¾å·²è¼‰å…¥çš„è¨‚å–®è³‡æ–™ä¸­æ‰¾åˆ°è©³æƒ…
    const cachedOrder = window.currentOrdersData?.find(order => 
      (order.order_id || order.id) == orderId
    );

    if (cachedOrder && cachedOrder.details && cachedOrder.details.length > 0) {
      console.log('âœ… ä½¿ç”¨å·²å¿«å–çš„è¨‚å–®è©³æƒ…');
      showOrderDetailsModal(orderId, cachedOrder.details, cachedOrder);
      return;
    }

    // å¦‚æœæ²’æœ‰å¿«å–çš„è©³æƒ…ï¼Œå˜—è©¦å¾APIè¼‰å…¥
    try {
      console.log('âš ï¸ æ²’æœ‰å¿«å–çš„è¨‚å–®è©³æƒ…ï¼Œå˜—è©¦å¾APIè¼‰å…¥...');
      showToast('info', 'æ­£åœ¨è¼‰å…¥è¨‚å–®è©³æƒ…...');

      // å…ˆé‡æ–°è¼‰å…¥è¨‚å–®è³‡æ–™ï¼ˆåŒ…å«è©³æƒ…ï¼‰
      const orders = await loadOrdersData();
      window.currentOrdersData = orders; // å„²å­˜åˆ°å…¨åŸŸè®Šæ•¸
      
      // å†æ¬¡å˜—è©¦æ‰¾åˆ°è¨‚å–®è©³æƒ…
      const order = orders.find(o => (o.order_id || o.id) == orderId);
      
      if (order && order.details && order.details.length > 0) {
        console.log('âœ… å¾é‡æ–°è¼‰å…¥çš„è³‡æ–™ä¸­æ‰¾åˆ°è¨‚å–®è©³æƒ…');
        showOrderDetailsModal(orderId, order.details, order);
      } else {
        console.log('âš ï¸ è©²è¨‚å–®æ²’æœ‰è©³ç´°å•†å“è³‡è¨Š');
        showToast('warning', 'æ­¤è¨‚å–®æ²’æœ‰è©³ç´°å•†å“è³‡è¨Š');
        
        // é¡¯ç¤ºåŸºæœ¬è¨‚å–®è³‡è¨Š
        showBasicOrderInfo(orderId);
      }

    } catch (error) {
      console.error('âŒ æŸ¥çœ‹è¨‚å–®è©³æƒ…éŒ¯èª¤:', error);
      showToast('error', 'æŸ¥çœ‹è¨‚å–®è©³æƒ…æ™‚ç™¼ç”ŸéŒ¯èª¤');
      
      // é€€è€Œæ±‚å…¶æ¬¡ï¼Œé¡¯ç¤ºåŸºæœ¬è³‡è¨Š
      showBasicOrderInfo(orderId);
    }
  }

  // é¡¯ç¤ºåŸºæœ¬è¨‚å–®è³‡è¨Šï¼ˆç•¶è©³ç´°APIä¸å¯ç”¨æ™‚ï¼‰
  function showBasicOrderInfo(orderId) {
    const orderDetails = [
      {
        product_id: 'N/A',
        product_name: 'è¨‚å–®è©³æƒ…è¼‰å…¥å¤±æ•—',
        quantity: 'N/A',
        price: 'N/A'
      }
    ];
    
    showOrderDetailsModal(orderId, orderDetails);
    showToast('warning', 'ç„¡æ³•è¼‰å…¥è©³ç´°å•†å“è³‡è¨Šï¼Œè«‹è¯ç¹«å®¢æœ');
  }

  // é¡¯ç¤ºè¨‚å–®è©³æƒ…å½ˆçª—
  function showOrderDetailsModal(orderId, orderDetails, orderInfo = null) {
    console.log('ğŸ“ é¡¯ç¤ºè¨‚å–®è©³æƒ…å½ˆçª—, è¨‚å–®ID:', orderId, 'è©³æƒ…:', orderDetails, 'è¨‚å–®è³‡è¨Š:', orderInfo);

    // ç§»é™¤ç¾æœ‰çš„å½ˆçª—
    const existingModal = document.getElementById('orderDetailsModal');
    if (existingModal) {
      existingModal.remove();
    }

    // å»ºç«‹å½ˆçª—HTML
    const modal = document.createElement('div');
    modal.id = 'orderDetailsModal';
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    `;

    // å»ºç«‹è¨‚å–®è©³æƒ…å…§å®¹
    let orderItemsHtml = '';
    let totalAmount = 0;
    
    // æ ¹æ“šå¾Œç«¯ getOrderDetailsByOrderId çš„å›æ‡‰æ ¼å¼è™•ç†
    if (Array.isArray(orderDetails) && orderDetails.length > 0) {
      orderItemsHtml = orderDetails.map(item => {
        const itemPrice = parseFloat(item.price || 0);
        const itemQuantity = parseInt(item.quantity || 1);
        const itemSubtotal = itemPrice * itemQuantity;
        totalAmount += itemSubtotal;
        
        // å˜—è©¦å¾ç•¶å‰å•†å“åˆ—è¡¨ä¸­æ‰¾åˆ°å•†å“åç¨±
        const product = currentProducts.find(p => p.product_id === item.product_id);
        const productName = product ? product.name : `å•†å“ ID: ${item.product_id}`;
        
        return `
          <tr>
            <td>${productName}</td>
            <td>$${formatPrice(itemPrice)}</td>
            <td>${itemQuantity}</td>
            <td>$${formatPrice(itemSubtotal)}</td>
          </tr>
        `;
      }).join('');
    } else {
      orderItemsHtml = '<tr><td colspan="4" style="text-align: center; color: #666;">ç„¡è©³ç´°å•†å“è³‡è¨Š</td></tr>';
    }

    // é¡¯ç¤ºè¨‚å–®æ—¥æœŸï¼Œå¦‚æœæœ‰å‚³å…¥è¨‚å–®è³‡è¨Šå°±ä½¿ç”¨çœŸå¯¦æ—¥æœŸ
    let orderDate = 'è«‹æŸ¥çœ‹è¨‚å–®åˆ—è¡¨';
    if (orderInfo && orderInfo.create_at) {
      orderDate = formatOrderDate(orderInfo.create_at);
    } else if (orderInfo && orderInfo.created_at) {
      orderDate = formatOrderDate(orderInfo.created_at);
    } else if (orderInfo && orderInfo.order_date) {
      orderDate = formatOrderDate(orderInfo.order_date);
    }

    modal.innerHTML = `
      <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f1f3f4; padding-bottom: 15px;">
          <h2 style="color: #333; margin: 0;">ğŸ“¦ è¨‚å–®è©³æƒ…</h2>
          <button onclick="closeOrderDetailsModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #666;">âœ–</button>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; color: #666; margin-bottom: 5px;">è¨‚å–®ç·¨è™Ÿ</div>
            <div style="font-size: 1.1em;">#${orderId}</div>
          </div>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; color: #666; margin-bottom: 5px;">è¨‚å–®æ—¥æœŸ</div>
            <div style="font-size: 1.1em;">${orderDate}</div>
          </div>
          <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
            <div style="font-weight: bold; color: #666; margin-bottom: 5px;">è¨‚å–®ç¸½é¡</div>
            <div style="font-size: 1.2em; color: #667eea; font-weight: bold;">$${formatPrice(totalAmount)}</div>
          </div>
        </div>
        
        <h3 style="color: #333; margin-bottom: 15px;">å•†å“æ˜ç´°</h3>
        <div style="border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: #f8f9fa;">
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">å•†å“åç¨±</th>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">å–®åƒ¹</th>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">æ•¸é‡</th>
                <th style="padding: 12px; text-align: left; border-bottom: 1px solid #dee2e6;">å°è¨ˆ</th>
              </tr>
            </thead>
            <tbody>
              ${orderItemsHtml}
            </tbody>
          </table>
        </div>
        
        <div style="text-align: center; margin-top: 25px;">
          <button onclick="closeOrderDetailsModal()" class="btn btn-primary" style="padding: 12px 30px;">é—œé–‰</button>
        </div>
      </div>
    `;

    document.body.appendChild(modal);

    // é»æ“Šå½ˆçª—å¤–éƒ¨é—œé–‰
    modal.addEventListener('click', function(e) {
      if (e.target === modal) {
        closeOrderDetailsModal();
      }
    });
  }

  // é—œé–‰è¨‚å–®è©³æƒ…å½ˆçª—
  function closeOrderDetailsModal() {
    const modal = document.getElementById('orderDetailsModal');
    if (modal) {
      modal.remove();
    }
  }

  // è™•ç†å€‹äººè³‡æ–™è¡¨å–®æäº¤
  document.addEventListener('DOMContentLoaded', function() {
    const profileForm = document.getElementById('profileForm');
    if (profileForm) {
      profileForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        
        // æ”¶é›†è¡¨å–®è³‡æ–™
        const formData = {
          name: document.getElementById('profileName').value.trim(),
          email: document.getElementById('profileEmail').value.trim(),
          phone: document.getElementById('profilePhone').value.trim(),
          address: document.getElementById('profileAddress').value.trim(),
          password: document.getElementById('profilePassword').value.trim(),
          passwordConfirm: document.getElementById('profilePasswordConfirm').value.trim()
        };

        // åŸºæœ¬é©—è­‰
        if (!formData.name) {
          showToast('error', 'è«‹è¼¸å…¥å§“å');
          return;
        }

        if (!formData.email) {
          showToast('error', 'è«‹è¼¸å…¥é›»å­éƒµä»¶');
          return;
        }

        // é›»å­éƒµä»¶æ ¼å¼é©—è­‰
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(formData.email)) {
          showToast('error', 'è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶æ ¼å¼');
          return;
        }

        // å¯†ç¢¼é©—è­‰ï¼ˆåªæœ‰åœ¨è¼¸å…¥æ–°å¯†ç¢¼æ™‚æ‰é©—è­‰ï¼‰
        if (formData.password || formData.passwordConfirm) {
          if (formData.password !== formData.passwordConfirm) {
            showToast('error', 'æ–°å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ä¸€è‡´');
            return;
          }
          
          if (formData.password.length < 6) {
            showToast('error', 'æ–°å¯†ç¢¼é•·åº¦è‡³å°‘éœ€è¦6å€‹å­—å…ƒ');
            return;
          }
        }

        // ç¦ç”¨æäº¤æŒ‰éˆ•ï¼Œé˜²æ­¢é‡è¤‡æäº¤
        const submitBtn = event.target.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = 'æ›´æ–°ä¸­...';

        try {
          // èª¿ç”¨æ›´æ–°å‡½æ•¸
          const success = await updateMemberProfile(formData);
          
          if (success) {
            console.log('âœ… å€‹äººè³‡æ–™æ›´æ–°æµç¨‹å®Œæˆ');
          }
          
        } finally {
          // æ¢å¾©æäº¤æŒ‰éˆ•
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      });
    }
  });
</script>
</body>
</html>